<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Generic functions for fmridesign package — event_model • fmridesign</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generic functions for fmridesign package — event_model"><meta name="description" content="This file contains the generic functions used throughout the fmridesign package.
These generics define the interface for working with event models, baseline models,
and related design components.
Construct an event model
This is the main constructor for event_model objects. It unifies the previous
formula and list-based interfaces and uses a more efficient internal pipeline."><meta property="og:description" content="This file contains the generic functions used throughout the fmridesign package.
These generics define the interface for working with event models, baseline models,
and related design components.
Construct an event model
This is the main constructor for event_model objects. It unifies the previous
formula and list-based interfaces and uses a more efficient internal pipeline."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fmridesign</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/a_01_introduction.html">Introduction to fmridesign</a></li>
    <li><a class="dropdown-item" href="../articles/a_03_baseline_model.html">Modeling Baseline and Nuisance Effects</a></li>
    <li><a class="dropdown-item" href="../articles/a_04_event_models.html">Building Event Models</a></li>
    <li><a class="dropdown-item" href="../articles/a_05_contrasts.html">Contrasts in fmridesign</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bbuchsbaum/fmridesign/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Generic functions for fmridesign package</h1>
      <small class="dont-index">Source: <a href="https://github.com/bbuchsbaum/fmridesign/blob/main/R/design_generics.R" class="external-link"><code>R/design_generics.R</code></a>, <a href="https://github.com/bbuchsbaum/fmridesign/blob/main/R/event_model.R" class="external-link"><code>R/event_model.R</code></a></small>
      <div class="d-none name"><code>event_model.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This file contains the generic functions used throughout the fmridesign package.
These generics define the interface for working with event models, baseline models,
and related design components.
Construct an event model</p>
<p>This is the main constructor for <code>event_model</code> objects. It unifies the previous
formula and list-based interfaces and uses a more efficient internal pipeline.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">event_model</span><span class="op">(</span></span>
<span>  <span class="va">formula_or_list</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">block</span>,</span>
<span>  <span class="va">sampling_frame</span>,</span>
<span>  durations <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  drop_empty <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  precision <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">event_model</span><span class="op">(</span></span>
<span>  <span class="va">formula_or_list</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">block</span>,</span>
<span>  <span class="va">sampling_frame</span>,</span>
<span>  durations <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  drop_empty <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  precision <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula-or-list">formula_or_list<a class="anchor" aria-label="anchor" href="#arg-formula-or-list"></a></dt>
<dd><p>Either a formula (e.g., <code>onset ~ hrf(cond) + hrf(mod)</code>)
or a list of pre-defined <code>hrfspec</code> objects.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A <code>data.frame</code> containing event variables referenced in the formula
or needed by the <code>hrfspec</code> objects.</p></dd>


<dt id="arg-block">block<a class="anchor" aria-label="anchor" href="#arg-block"></a></dt>
<dd><p>A formula (e.g., <code>~ run</code>) or vector specifying the block/run for each event.</p></dd>


<dt id="arg-sampling-frame">sampling_frame<a class="anchor" aria-label="anchor" href="#arg-sampling-frame"></a></dt>
<dd><p>An object of class <code>sampling_frame</code> defining the scan timing (TR, block lengths).</p></dd>


<dt id="arg-durations">durations<a class="anchor" aria-label="anchor" href="#arg-durations"></a></dt>
<dd><p>Numeric vector or scalar specifying event durations (seconds). Default is 0.</p></dd>


<dt id="arg-drop-empty">drop_empty<a class="anchor" aria-label="anchor" href="#arg-drop-empty"></a></dt>
<dd><p>Logical indicating whether to drop empty events during term construction. Default is TRUE.</p></dd>


<dt id="arg-precision">precision<a class="anchor" aria-label="anchor" href="#arg-precision"></a></dt>
<dd><p>Numeric precision for HRF sampling/convolution. Default is 0.3.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>Logical indicating whether to use parallel processing for term convolution (requires <code>future.apply</code>). Default is FALSE.</p></dd>


<dt id="arg-progress">progress<a class="anchor" aria-label="anchor" href="#arg-progress"></a></dt>
<dd><p>Logical indicating whether to show a progress bar during term realisation. Default is FALSE.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments (currently unused).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An <code>event_model</code> object describing the task design.</p>
<p>An object of class <code>c("event_model", "list")</code> containing the terms, design matrix,
sampling frame, and other metadata.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function creates an event-based fMRI regression model, represented as a data structure.</p>
<div class="section">
<h3 id="column-naming">Column Naming<a class="anchor" aria-label="anchor" href="#column-naming"></a></h3>


<p>The columns in the resulting design matrix follow the naming convention:
<code>term_tag</code> + <code>_</code> + <code>condition_tag</code> + <code>_b##</code> basis suffix</p>
<p>Where:</p><ul><li><p><code>term_tag</code>: The unique tag assigned to the <code><a href="hrf.html">hrf()</a></code> term (see below).</p></li>
<li><p><code>condition_tag</code>: Represents the specific factor level or continuous regressor within the term (e.g., <code>condition.A</code>, <code>poly_RT_01</code>, <code>condition.A_task.go</code>).</p></li>
<li><p><code>_b##</code>: Optional suffix added for HRFs with multiple basis functions (e.g., <code>_b01</code>, <code>_b02</code>).</p></li>
</ul></div>

<div class="section">
<h3 id="term-naming-and-clash-resolution">Term Naming and Clash Resolution<a class="anchor" aria-label="anchor" href="#term-naming-and-clash-resolution"></a></h3>


<p>Each term in the model (typically defined by an <code><a href="hrf.html">hrf()</a></code> call in a formula) gets a
unique <code>term_tag</code>. This tag is used as the prefix for all columns generated by that term.</p><ul><li><p><strong>Default Naming:</strong> If no explicit <code>id</code> (or <code>name</code>) is given in <code><a href="hrf.html">hrf()</a></code>, the tag is derived
from the variable names (e.g., <code>hrf(condition)</code> -&gt; <code>condition</code>, <code>hrf(RT, acc)</code> -&gt; <code>RT_acc</code>).</p></li>
<li><p><strong>Explicit Naming:</strong> Use <code>id=</code> within <code><a href="hrf.html">hrf()</a></code> for an explicit tag (e.g., <code>hrf(condition, id="CondMain")</code>).</p></li>
<li><p><strong>Sanitization:</strong> Dots (<code>.</code>) in tags are converted to underscores (<code>_</code>).</p></li>
<li><p><strong>Clash Resolution:</strong> If multiple terms generate the same tag, <code>#</code> and a number are appended
to ensure uniqueness (e.g., <code>condition</code>, <code>condition#1</code>).</p></li>
</ul><p>This consistent naming scheme replaces the previous <code>compact</code> and <code>qualified</code> styles.</p>
</div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Example using formula interface</span></span></span>
<span class="r-in"><span><span class="va">des</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>onset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">90</span>, by<span class="op">=</span><span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  run <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, each<span class="op">=</span><span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  cond <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>,<span class="st">"B"</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  mod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sframe</span> <span class="op">&lt;-</span> <span class="fu">fmrihrf</span><span class="fu">::</span><span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame</a></span><span class="op">(</span>blocklens<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">60</span><span class="op">)</span>, TR<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ev_model_form</span> <span class="op">&lt;-</span> <span class="fu">event_model</span><span class="op">(</span><span class="va">onset</span> <span class="op">~</span> <span class="fu"><a href="hrf.html">hrf</a></span><span class="op">(</span><span class="va">cond</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="hrf.html">hrf</a></span><span class="op">(</span><span class="va">mod</span>, basis<span class="op">=</span><span class="st">"spmg3"</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                            data <span class="op">=</span> <span class="va">des</span>, block <span class="op">=</span> <span class="op">~</span><span class="va">run</span>, sampling_frame <span class="op">=</span> <span class="va">sframe</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ev_model_form</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">fMRI Event Model</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Number of Terms:</span> 2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Number of Events:</span> 10</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Number of Blocks:</span> 2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Total Scans:</span> 110</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">Design Matrix Dimensions:</span> 110 x 5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Terms</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • <span style="color: #00BB00;">cond</span> (<span style="color: #0000BB;">&lt;event_term&gt;</span>)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • <span style="color: #00BB00;">mod</span> (<span style="color: #0000BB;">&lt;event_term&gt;</span>)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Design Matrix Preview</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>           cond_cond.A cond_cond.B mod_mod_b01 mod_mod_b02</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Scan 1   0.062       0.000      -0.040      -0.126    </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Scan 2   1.138       0.000      -0.727      -0.407    </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Scan 3   1.744       0.000      -1.115       0.042    </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #B2B2B2;">...</span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="design_matrix.html">design_matrix</a></span><span class="op">(</span><span class="va">ev_model_form</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 6 × 5</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   cond_cond.A cond_cond.B mod_mod_b01 mod_mod_b02 mod_mod_b03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>      0.062<span style="text-decoration: underline;">4</span>      0          -<span style="color: #BB0000;">0.039</span><span style="color: #BB0000; text-decoration: underline;">9</span>     -<span style="color: #BB0000;">0.126</span>     -<span style="color: #BB0000;">0.262</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span>      1.14        0          -<span style="color: #BB0000;">0.727</span>      -<span style="color: #BB0000;">0.407</span>      0.123  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span>      1.74        0          -<span style="color: #BB0000;">1.12</span>        0.042<span style="text-decoration: underline;">0</span>     0.205  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span>      1.20        0          -<span style="color: #BB0000;">0.769</span>       0.236      0.002<span style="text-decoration: underline;">77</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span>      0.552       0          -<span style="color: #BB0000;">0.353</span>       0.163     -<span style="color: #BB0000;">0.052</span><span style="color: #BB0000; text-decoration: underline;">3</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">6</span>      0.192       0.034<span style="text-decoration: underline;">1</span>     -<span style="color: #BB0000;">0.151</span>      -<span style="color: #BB0000;">0.033</span><span style="color: #BB0000; text-decoration: underline;">8</span>    -<span style="color: #BB0000;">0.314</span>  </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example using list interface (less common)</span></span></span>
<span class="r-in"><span><span class="co"># spec1 &lt;- hrf(cond)</span></span></span>
<span class="r-in"><span><span class="co"># spec2 &lt;- hrf(mod, basis="spmg3")</span></span></span>
<span class="r-in"><span><span class="co"># ev_model_list &lt;- event_model(list(spec1, spec2), data=des, block=des$run, sampling_frame=sframe)</span></span></span>
<span class="r-in"><span><span class="co"># print(ev_model_list)                         </span></span></span>
<span class="r-in"><span>                             </span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bradley Buchsbaum.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

