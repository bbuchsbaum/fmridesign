<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to fmridesign • fmridesign</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to fmridesign">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fmridesign</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a_01_introduction.html">Introduction to fmridesign</a></li>
    <li><a class="dropdown-item" href="../articles/a_03_baseline_model.html">Modeling Baseline and Nuisance Effects</a></li>
    <li><a class="dropdown-item" href="../articles/a_04_event_models.html">Building Event Models</a></li>
    <li><a class="dropdown-item" href="../articles/a_05_contrasts.html">Contrasts in fmridesign</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bbuchsbaum/fmridesign/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to fmridesign</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bbuchsbaum/fmridesign/blob/main/vignettes/a_01_introduction.Rmd" class="external-link"><code>vignettes/a_01_introduction.Rmd</code></a></small>
      <div class="d-none name"><code>a_01_introduction.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bbuchsbaum/fmridesign" class="external-link">fmridesign</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'fmridesign'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     contrasts, convolve</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p><code>fmridesign</code> helps you build fMRI design matrices cleanly
and consistently. It covers task regressors (events convolved with HRFs)
and baseline/nuisance terms (drift, intercepts, motion). You use a
simple formula interface to define models, visualize and inspect them,
and then feed the matrices into your GLM workflow.</p>
<p>Key ideas: event models (task effects), baseline models (drift and
nuisance), clear naming, and plots that make it easy to spot
problems.</p>
</div>
<div class="section level2">
<h2 id="the-fmri-design-matrix">The fMRI Design Matrix<a class="anchor" aria-label="anchor" href="#the-fmri-design-matrix"></a>
</h2>
<p>In fMRI analysis, the design matrix (X) is fundamental to the general
linear model:</p>
<pre class="text"><code><span><span class="va">Y</span> <span class="op">=</span> <span class="va">Xβ</span> <span class="op">+</span> <span class="va">ε</span></span></code></pre>
<p>Where: - <strong>Y</strong>: Observed BOLD signal time series -
<strong>X</strong>: Design matrix containing predictors -
<strong>β</strong>: Parameter estimates (regression coefficients) -
<strong>ε</strong>: Error term (noise)</p>
<p>The design matrix typically combines task-related predictors
(expected responses to events) and nuisance predictors (drift, motion,
physiology). Both are essential for reliable inference.</p>
</div>
<div class="section level2">
<h2 id="package-architecture">Package Architecture<a class="anchor" aria-label="anchor" href="#package-architecture"></a>
</h2>
<p>Design construction is split into two parts:</p>
<ul>
<li>Event models (<code><a href="../reference/event_model.html">event_model()</a></code>): specify onsets (and
optional durations), choose HRF basis per term, and include factors,
continuous modulators, and covariates.</li>
<li>Baseline models (<code><a href="../reference/baseline_model.html">baseline_model()</a></code>): add drift terms
(polynomial/spline/constant), block-wise intercepts, and any nuisance
regressors you provide.</li>
</ul>
</div>
<div class="section level2">
<h2 id="quick-start-complete-workflow">Quick Start: Complete Workflow<a class="anchor" aria-label="anchor" href="#quick-start-complete-workflow"></a>
</h2>
<p>Here’s a minimal example demonstrating the complete workflow from
experimental design to design matrix:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Define the temporal structure (2 runs, 150 scans each, TR = 2s)</span></span>
<span><span class="va">TR</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">sframe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame</a></span><span class="op">(</span>blocklens <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">150</span>, <span class="fl">150</span><span class="op">)</span>, TR <span class="op">=</span> <span class="va">TR</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Create experimental events</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="co"># Simple two-condition design with 20 events per run</span></span>
<span><span class="va">conditions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">10</span>, times <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">onsets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">0</span>, <span class="fl">150</span> <span class="op">*</span> <span class="va">TR</span> <span class="op">-</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># Run 1</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">0</span>, <span class="fl">150</span> <span class="op">*</span> <span class="va">TR</span> <span class="op">-</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span>   <span class="co"># Run 2</span></span>
<span><span class="op">)</span></span>
<span><span class="va">blockids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, each <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Build the event model</span></span>
<span><span class="va">emodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/event_model.html">event_model</a></span><span class="op">(</span></span>
<span>  <span class="va">onset</span> <span class="op">~</span> <span class="fu"><a href="../reference/hrf.html">hrf</a></span><span class="op">(</span><span class="va">Condition</span>, basis <span class="op">=</span> <span class="st">"spmg1"</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    onset <span class="op">=</span> <span class="va">onsets</span>,</span>
<span>    Condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">conditions</span><span class="op">)</span>,</span>
<span>    block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">blockids</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  block <span class="op">=</span> <span class="op">~</span> <span class="va">block</span>,</span>
<span>  sampling_frame <span class="op">=</span> <span class="va">sframe</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. Build the baseline model</span></span>
<span><span class="va">bmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/baseline_model.html">baseline_model</a></span><span class="op">(</span></span>
<span>  basis <span class="op">=</span> <span class="st">"poly"</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  sframe <span class="op">=</span> <span class="va">sframe</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 5. Extract design matrices</span></span>
<span><span class="va">X_task</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design_matrix.html">design_matrix</a></span><span class="op">(</span><span class="va">emodel</span><span class="op">)</span></span>
<span><span class="va">X_baseline</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design_matrix.html">design_matrix</a></span><span class="op">(</span><span class="va">bmodel</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 6. Combine into full design matrix</span></span>
<span><span class="va">X_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">X_task</span>, <span class="va">X_baseline</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">X_full</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 300  10</span></span>
<span></span>
<span><span class="co"># 7. Visualize the complete design</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">emodel</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_introduction_files/figure-html/complete_example-1.png" alt="Predicted BOLD regressors over time for an example event model (two runs)."></p>
</div>
<div class="section level2">
<h2 id="understanding-the-components">Understanding the Components<a class="anchor" aria-label="anchor" href="#understanding-the-components"></a>
</h2>
<div class="section level3">
<h3 id="sampling-frame">Sampling Frame<a class="anchor" aria-label="anchor" href="#sampling-frame"></a>
</h3>
<p>The <code>sampling_frame</code> object defines the temporal structure
of your fMRI data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Single run: 200 scans, TR = 2 seconds</span></span>
<span><span class="va">sframe_single</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame</a></span><span class="op">(</span>blocklens <span class="op">=</span> <span class="fl">200</span>, TR <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sframe_single</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sampling Frame</span></span>
<span><span class="co">#&gt; ==============</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Structure:</span></span>
<span><span class="co">#&gt;   1 block</span></span>
<span><span class="co">#&gt;   Total scans: 200</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Timing:</span></span>
<span><span class="co">#&gt;   TR: 2 s</span></span>
<span><span class="co">#&gt;   Precision: 0.1 s</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Duration:</span></span>
<span><span class="co">#&gt;   Total time: 400.0 s</span></span>
<span></span>
<span><span class="co"># Multiple runs: 3 runs with different lengths</span></span>
<span><span class="va">sframe_multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame</a></span><span class="op">(</span>blocklens <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">150</span>, <span class="fl">200</span>, <span class="fl">150</span><span class="op">)</span>, TR <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sframe_multi</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sampling Frame</span></span>
<span><span class="co">#&gt; ==============</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Structure:</span></span>
<span><span class="co">#&gt;   3 blocks</span></span>
<span><span class="co">#&gt;   Total scans: 500</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Timing:</span></span>
<span><span class="co">#&gt;   TR: 2 s</span></span>
<span><span class="co">#&gt;   Precision: 0.1 s</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Duration:</span></span>
<span><span class="co">#&gt;   Total time: 1000.0 s</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="event-specification">Event Specification<a class="anchor" aria-label="anchor" href="#event-specification"></a>
</h3>
<p>Events are typically specified with the formula interface:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Formula interface (recommended)</span></span>
<span><span class="va">emodel_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/event_model.html">event_model</a></span><span class="op">(</span></span>
<span>  <span class="va">onset</span> <span class="op">~</span> <span class="fu"><a href="../reference/hrf.html">hrf</a></span><span class="op">(</span><span class="va">condition</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/hrf.html">hrf</a></span><span class="op">(</span><span class="va">RT</span>, basis <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    onset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">70</span><span class="op">)</span>,</span>
<span>    condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"easy"</span>, <span class="st">"hard"</span>, <span class="st">"easy"</span>, <span class="st">"hard"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    RT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">0.4</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>    block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  block <span class="op">=</span> <span class="op">~</span> <span class="va">block</span>,</span>
<span>  sampling_frame <span class="op">=</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame</a></span><span class="op">(</span><span class="fl">100</span>, TR <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="common-use-cases">Common Use Cases<a class="anchor" aria-label="anchor" href="#common-use-cases"></a>
</h2>
<div class="section level3">
<h3 id="block-design">1. Block Design<a class="anchor" aria-label="anchor" href="#block-design"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Block design with 20-second blocks</span></span>
<span><span class="va">block_onsets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">280</span>, by <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span>
<span><span class="va">block_conditions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"task"</span>, <span class="st">"rest"</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">block_onsets</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">block_durations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">block_onsets</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">emodel_block</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/event_model.html">event_model</a></span><span class="op">(</span></span>
<span>  <span class="va">onset</span> <span class="op">~</span> <span class="fu"><a href="../reference/hrf.html">hrf</a></span><span class="op">(</span><span class="va">condition</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    onset <span class="op">=</span> <span class="va">block_onsets</span>,</span>
<span>    condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">block_conditions</span><span class="op">)</span>,</span>
<span>    block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">block_onsets</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  block <span class="op">=</span> <span class="op">~</span> <span class="va">block</span>,</span>
<span>  durations <span class="op">=</span> <span class="va">block_durations</span>,</span>
<span>  sampling_frame <span class="op">=</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame</a></span><span class="op">(</span><span class="fl">150</span>, TR <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">emodel_block</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_introduction_files/figure-html/block_design-1.png" alt="Block design regressors (task and rest blocks) over time."></p>
</div>
<div class="section level3">
<h3 id="rapid-event-related-design">2. Rapid Event-Related Design<a class="anchor" aria-label="anchor" href="#rapid-event-related-design"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Rapid event-related with jittered ISI</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span></span>
<span><span class="va">n_events</span> <span class="op">&lt;-</span> <span class="fl">60</span></span>
<span><span class="va">rapid_onsets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_events</span>, <span class="fl">2</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>  <span class="co"># ISI between 2-6s</span></span>
<span><span class="va">rapid_conditions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"face"</span>, <span class="st">"house"</span>, <span class="st">"object"</span><span class="op">)</span>, <span class="va">n_events</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">emodel_rapid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/event_model.html">event_model</a></span><span class="op">(</span></span>
<span>  <span class="va">onset</span> <span class="op">~</span> <span class="fu"><a href="../reference/hrf.html">hrf</a></span><span class="op">(</span><span class="va">stimulus</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    onset <span class="op">=</span> <span class="va">rapid_onsets</span>,</span>
<span>    stimulus <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">rapid_conditions</span><span class="op">)</span>,</span>
<span>    block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n_events</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  block <span class="op">=</span> <span class="op">~</span> <span class="va">block</span>,</span>
<span>  sampling_frame <span class="op">=</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">rapid_onsets</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fl">20</span>, TR <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check design efficiency</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="../reference/design_matrix.html">design_matrix</a></span><span class="op">(</span><span class="va">emodel_rapid</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                          stimulus_stimulus.face stimulus_stimulus.house</span></span>
<span><span class="co">#&gt; stimulus_stimulus.face                1.0000000             -0.29766943</span></span>
<span><span class="co">#&gt; stimulus_stimulus.house              -0.2976694              1.00000000</span></span>
<span><span class="co">#&gt; stimulus_stimulus.object             -0.3687703             -0.09145211</span></span>
<span><span class="co">#&gt;                          stimulus_stimulus.object</span></span>
<span><span class="co">#&gt; stimulus_stimulus.face                -0.36877029</span></span>
<span><span class="co">#&gt; stimulus_stimulus.house               -0.09145211</span></span>
<span><span class="co">#&gt; stimulus_stimulus.object               1.00000000</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="parametric-modulation">3. Parametric Modulation<a class="anchor" aria-label="anchor" href="#parametric-modulation"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Event-related design with RT modulation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">789</span><span class="op">)</span></span>
<span><span class="va">n_trials</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="va">pm_onsets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_trials</span>, <span class="fl">0</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pm_conditions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="va">n_trials</span><span class="op">)</span></span>
<span><span class="va">pm_RT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_trials</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">pm_conditions</span> <span class="op">==</span> <span class="st">"congruent"</span>, <span class="fl">0.5</span>, <span class="fl">0.7</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">emodel_parametric</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/event_model.html">event_model</a></span><span class="op">(</span></span>
<span>  <span class="va">onset</span> <span class="op">~</span> <span class="fu"><a href="../reference/hrf.html">hrf</a></span><span class="op">(</span><span class="va">condition</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/hrf.html">hrf</a></span><span class="op">(</span><span class="va">RT</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    onset <span class="op">=</span> <span class="va">pm_onsets</span>,</span>
<span>    condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">pm_conditions</span><span class="op">)</span>,</span>
<span>    RT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">pm_RT</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,  <span class="co"># Center the parametric modulator</span></span>
<span>    block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n_trials</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  block <span class="op">=</span> <span class="op">~</span> <span class="va">block</span>,</span>
<span>  sampling_frame <span class="op">=</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame</a></span><span class="op">(</span><span class="fl">120</span>, TR <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize the parametric modulator</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">emodel_parametric</span>, term_name <span class="op">=</span> <span class="st">"RT"</span><span class="op">)</span></span></code></pre></div>
<p><img src="a_01_introduction_files/figure-html/parametric-1.png" alt="Parametric modulator (RT) regressor and conditions plotted over time."></p>
</div>
</div>
<div class="section level2">
<h2 id="integration-with-fmri-analysis">Integration with fMRI Analysis<a class="anchor" aria-label="anchor" href="#integration-with-fmri-analysis"></a>
</h2>
<p>The design matrices created by <code>fmridesign</code> can be used
with various fMRI analysis approaches:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example: Export for use with external software</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="../reference/design_matrix.html">design_matrix</a></span><span class="op">(</span><span class="va">emodel</span><span class="op">)</span>, <span class="fu"><a href="../reference/design_matrix.html">design_matrix</a></span><span class="op">(</span><span class="va">bmodel</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save as text file for SPM, FSL, or AFNI</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.table</a></span><span class="op">(</span><span class="va">X</span>, <span class="st">"design_matrix.txt"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, col.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For use with R-based analysis</span></span>
<span><span class="co"># Assuming Y is your fMRI time series data</span></span>
<span><span class="co"># fit &lt;- lm(Y ~ X - 1)  # -1 removes intercept as it's in the design</span></span>
<span></span>
<span><span class="co"># Or use with specialized fMRI packages</span></span>
<span><span class="co"># library(fmri)</span></span>
<span><span class="co"># results &lt;- fmri_glm(Y, X)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="best-practices">Best Practices<a class="anchor" aria-label="anchor" href="#best-practices"></a>
</h2>
<p>Always inspect your design. Look for sensible timing, HRF shapes that
match expectations, and acceptable correlations among regressors. Plan
for efficiency (jitter and balance help), and match baseline flexibility
to run length (short runs need fewer drift terms than long ones).
Include relevant nuisance regressors when available (e.g., motion,
physiology, artifact/outlier flags).</p>
</div>
<div class="section level2">
<h2 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<p>For more detailed information, see the following vignettes:</p>
<ul>
<li>
<code><a href="../articles/a_03_baseline_model.html">vignette("a_03_baseline_model")</a></code>: In-depth coverage of
baseline and nuisance modeling</li>
<li>
<code><a href="../articles/a_04_event_models.html">vignette("a_04_event_models")</a></code>: Comprehensive guide to
event model specification</li>
<li>Visit the <a href="https://github.com/bbuchsbaum/fmrihrf" class="external-link">fmrihrf
package documentation</a> for HRF details</li>
</ul>
</div>
<div class="section level2">
<h2 id="getting-help">Getting Help<a class="anchor" aria-label="anchor" href="#getting-help"></a>
</h2>
<p>If you encounter issues or have questions:</p>
<ol style="list-style-type: decimal">
<li>Check the function documentation: <code><a href="../reference/event_model.html">?event_model</a></code>,
<code><a href="../reference/baseline_model.html">?baseline_model</a></code>
</li>
<li>Browse all available HRFs: <code>list_available_hrfs()</code>
</li>
<li>Report issues: <a href="https://github.com/bbuchsbaum/fmridesign/issues" class="external-link">GitHub
Issues</a>
</li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bradley Buchsbaum.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
