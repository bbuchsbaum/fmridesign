<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Contrasts in fmridesign • fmridesign</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Contrasts in fmridesign">
<meta name="description" content="Guide to defining and using contrasts for hypothesis testing in fMRI designs.">
<meta property="og:description" content="Guide to defining and using contrasts for hypothesis testing in fMRI designs.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fmridesign</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="../articles/a_01_introduction.html">Introduction to fmridesign</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Core Concepts</h6></li>
    <li><a class="dropdown-item" href="../articles/a_04_event_models.html">Building Event Models</a></li>
    <li><a class="dropdown-item" href="../articles/a_03_baseline_model.html">Baseline and Nuisance Effects</a></li>
    <li><a class="dropdown-item" href="../articles/a_05_contrasts.html">Contrasts</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bbuchsbaum/fmridesign/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Contrasts in fmridesign</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bbuchsbaum/fmridesign/blob/main/vignettes/a_05_contrasts.Rmd" class="external-link"><code>vignettes/a_05_contrasts.Rmd</code></a></small>
      <div class="d-none name"><code>a_05_contrasts.Rmd</code></div>
    </div>

    
    
<!-- Removed per-page palette injection; default palette is red via CSS root variables. -->
<style>:root{--content:80ch}</style>
<div class="section level2">
<h2 id="introduction-to-contrasts">Introduction to Contrasts<a class="anchor" aria-label="anchor" href="#introduction-to-contrasts"></a>
</h2>
<p>Contrasts specify linear combinations of GLM parameters (β) to test
hypotheses about conditions or trends. In <code>fmridesign</code>,
define contrasts inside <code><a href="../reference/hrf.html">hrf()</a></code> calls using helper functions,
then extract weights with <code><a href="../reference/contrast_weights.html">contrast_weights()</a></code> (and F-sets
with <code><a href="../reference/Fcontrasts.html">Fcontrasts()</a></code>).</p>
</div>
<div class="section level2">
<h2 id="types-of-contrasts">Types of Contrasts<a class="anchor" aria-label="anchor" href="#types-of-contrasts"></a>
</h2>
<p>T-contrasts use a single contrast vector for directional questions
(e.g., A &gt; B). F-contrasts use a matrix to test sets of effects
(e.g., any difference among levels), returning omnibus statistics.</p>
</div>
<div class="section level2">
<h2 id="defining-contrasts-in-event-models">Defining Contrasts in Event Models<a class="anchor" aria-label="anchor" href="#defining-contrasts-in-event-models"></a>
</h2>
<p>Contrasts can be specified directly within the
<code><a href="../reference/event_model.html">event_model()</a></code> formula using the <code>contrasts</code>
argument in <code><a href="../reference/hrf.html">hrf()</a></code> terms:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a simple two-condition experiment</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">sframe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame</a></span><span class="op">(</span>blocklens <span class="op">=</span> <span class="fl">200</span>, TR <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate events</span></span>
<span><span class="va">onsets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">0</span>, <span class="fl">350</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">conditions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span><span class="op">)</span>, <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define contrasts within the model</span></span>
<span><span class="va">emodel_with_contrast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/event_model.html">event_model</a></span><span class="op">(</span></span>
<span>  <span class="va">onset</span> <span class="op">~</span> <span class="fu"><a href="../reference/hrf.html">hrf</a></span><span class="op">(</span><span class="va">hand</span>, contrasts <span class="op">=</span> <span class="fu"><a href="../reference/pair_contrast.html">pair_contrast</a></span><span class="op">(</span><span class="op">~</span> <span class="va">hand</span> <span class="op">==</span> <span class="st">"left"</span>, <span class="op">~</span> <span class="va">hand</span> <span class="op">==</span> <span class="st">"right"</span>, name <span class="op">=</span> <span class="st">"left_vs_right"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    onset <span class="op">=</span> <span class="va">onsets</span>,</span>
<span>    hand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">conditions</span><span class="op">)</span>,</span>
<span>    block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">40</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  block <span class="op">=</span> <span class="op">~</span> <span class="va">block</span>,</span>
<span>  sampling_frame <span class="op">=</span> <span class="va">sframe</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract contrast weights</span></span>
<span><span class="fu"><a href="../reference/contrast_weights.html">contrast_weights</a></span><span class="op">(</span><span class="va">emodel_with_contrast</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`hand#left_vs_right`</span></span>
<span><span class="co">#&gt; contrast: left_vs_right </span></span>
<span><span class="co">#&gt;  A:  ~hand == "left" </span></span>
<span><span class="co">#&gt;  B:  ~hand == "right" </span></span>
<span><span class="co">#&gt;  term:  hand </span></span>
<span><span class="co">#&gt;  weights:  </span></span>
<span><span class="co">#&gt;            left_vs_right</span></span>
<span><span class="co">#&gt; hand.left              1</span></span>
<span><span class="co">#&gt; hand.right            -1</span></span>
<span><span class="co">#&gt;  conditions:  hand_hand.left hand_hand.right</span></span></code></pre></div>
<div class="section level3">
<h3 id="quick-validation">Quick Validation<a class="anchor" aria-label="anchor" href="#quick-validation"></a>
</h3>
<p>Validate all attached contrasts for a model in one call:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/validate_contrasts.html">validate_contrasts</a></span><span class="op">(</span><span class="va">emodel_with_contrast</span><span class="op">)</span></span>
<span><span class="co"># 'full_rank' is only meaningful for F-contrasts; drop it when all are t-contrasts</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">type</span> <span class="op">==</span> <span class="st">"F"</span><span class="op">)</span><span class="op">)</span> <span class="va">res</span><span class="op">$</span><span class="va">full_rank</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">res</span></span>
<span><span class="co">#&gt;                 name type estimable sum_to_zero orthogonal_to_intercept</span></span>
<span><span class="co">#&gt; 2          hand#hand    t      TRUE        TRUE                    TRUE</span></span>
<span><span class="co">#&gt; 1 hand#left_vs_right    t      TRUE        TRUE                    TRUE</span></span>
<span><span class="co">#&gt;   nonzero_weights</span></span>
<span><span class="co">#&gt; 2               2</span></span>
<span><span class="co">#&gt; 1               2</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="advanced-contrast-specifications">Advanced Contrast Specifications<a class="anchor" aria-label="anchor" href="#advanced-contrast-specifications"></a>
</h2>
<div class="section level3">
<h3 id="pairwise-contrasts">Pairwise Contrasts<a class="anchor" aria-label="anchor" href="#pairwise-contrasts"></a>
</h3>
<p>For designs with multiple levels, you can specify all pairwise
comparisons:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Three-condition experiment</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span></span>
<span><span class="va">conditions_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"easy"</span>, <span class="st">"medium"</span>, <span class="st">"hard"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">onsets_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">45</span>, <span class="fl">0</span>, <span class="fl">350</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">emodel_pairwise</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/event_model.html">event_model</a></span><span class="op">(</span></span>
<span>  <span class="va">onset</span> <span class="op">~</span> <span class="fu"><a href="../reference/hrf.html">hrf</a></span><span class="op">(</span><span class="va">difficulty</span>,</span>
<span>              contrasts <span class="op">=</span> <span class="fu"><a href="../reference/pairwise_contrasts.html">pairwise_contrasts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"easy"</span>,<span class="st">"medium"</span>,<span class="st">"hard"</span><span class="op">)</span>, facname <span class="op">=</span> <span class="st">"difficulty"</span>, name_prefix <span class="op">=</span> <span class="st">"pair"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    onset <span class="op">=</span> <span class="va">onsets_3</span>,</span>
<span>    difficulty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">conditions_3</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"easy"</span>, <span class="st">"medium"</span>, <span class="st">"hard"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">45</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  block <span class="op">=</span> <span class="op">~</span> <span class="va">block</span>,</span>
<span>  sampling_frame <span class="op">=</span> <span class="va">sframe</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View all contrasts</span></span>
<span><span class="va">contrasts_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/contrast_weights.html">contrast_weights</a></span><span class="op">(</span><span class="va">emodel_pairwise</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">contrasts_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "difficulty#pair_easy_medium" "difficulty#pair_easy_hard"  </span></span>
<span><span class="co">#&gt; [3] "difficulty#pair_medium_hard"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="polynomial-contrasts">Polynomial Contrasts<a class="anchor" aria-label="anchor" href="#polynomial-contrasts"></a>
</h3>
<p>Test for linear, quadratic, or higher‑order trends across ordered
conditions. Note: <code><a href="../reference/poly_contrast.html">poly_contrast()</a></code> with
<code>degree = k</code> returns an F‑contrast matrix with k orthogonal
columns (linear, quadratic, …, k‑th), so you usually only need a single
call rather than separate one‑by‑one contrasts.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Parametric design with 4 levels</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">789</span><span class="op">)</span></span>
<span><span class="va">intensity_levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, each <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span><span class="va">onsets_param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">48</span>, <span class="fl">0</span>, <span class="fl">350</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a single polynomial contrast up to cubic (3 columns: linear/quadratic/cubic)</span></span>
<span><span class="va">emodel_polynomial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/event_model.html">event_model</a></span><span class="op">(</span></span>
<span>  <span class="va">onset</span> <span class="op">~</span> <span class="fu"><a href="../reference/hrf.html">hrf</a></span><span class="op">(</span><span class="va">intensity</span>,</span>
<span>              contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                poly_trend <span class="op">=</span> <span class="fu"><a href="../reference/poly_contrast.html">poly_contrast</a></span><span class="op">(</span><span class="op">~</span> <span class="va">intensity</span>, name <span class="op">=</span> <span class="st">"poly_trend"</span>, degree <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span>              <span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    onset <span class="op">=</span> <span class="va">onsets_param</span>,</span>
<span>    intensity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">intensity_levels</span><span class="op">)</span>,</span>
<span>    block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">48</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  block <span class="op">=</span> <span class="op">~</span> <span class="va">block</span>,</span>
<span>  sampling_frame <span class="op">=</span> <span class="va">sframe</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract polynomial contrast weights (3 columns = linear, quadratic, cubic)</span></span>
<span><span class="va">poly_contrasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/contrast_weights.html">contrast_weights</a></span><span class="op">(</span><span class="va">emodel_polynomial</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">poly_contrasts</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "intensity#poly_trend"</span></span>
<span><span class="va">pc</span> <span class="op">&lt;-</span> <span class="va">poly_contrasts</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pc</span><span class="op">$</span><span class="va">weights</span>, <span class="fl">6</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;             poly_trend_1 poly_trend_2 poly_trend_3</span></span>
<span><span class="co">#&gt; intensity.1       -0.671          0.5       -0.224</span></span>
<span><span class="co">#&gt; intensity.2       -0.224         -0.5        0.671</span></span>
<span><span class="co">#&gt; intensity.3        0.224         -0.5       -0.671</span></span>
<span><span class="co">#&gt; intensity.4        0.671          0.5        0.224</span></span>
<span></span>
<span><span class="co"># If you want a specific component, select a column (e.g., linear = column 1)</span></span>
<span><span class="va">linear_weights</span> <span class="op">&lt;-</span> <span class="va">pc</span><span class="op">$</span><span class="va">weights</span><span class="op">[</span>, <span class="fl">1</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">linear_weights</span><span class="op">)</span></span>
<span><span class="co">#&gt;             poly_trend_1</span></span>
<span><span class="co">#&gt; intensity.1   -0.6708204</span></span>
<span><span class="co">#&gt; intensity.2   -0.2236068</span></span>
<span><span class="co">#&gt; intensity.3    0.2236068</span></span>
<span><span class="co">#&gt; intensity.4    0.6708204</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="factorial-design-contrasts">Factorial Design Contrasts<a class="anchor" aria-label="anchor" href="#factorial-design-contrasts"></a>
</h2>
<div class="section level3">
<h3 id="main-effects-and-interactions">Main Effects and Interactions<a class="anchor" aria-label="anchor" href="#main-effects-and-interactions"></a>
</h3>
<p>For factorial designs, specify contrasts for main effects and
interactions:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 2x2 factorial design</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">234</span><span class="op">)</span></span>
<span><span class="va">n_trials</span> <span class="op">&lt;-</span> <span class="fl">60</span></span>
<span><span class="va">factor_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A1"</span>, <span class="st">"A2"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">factor_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B1"</span>, <span class="st">"B2"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">factorial_onsets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_trials</span>, <span class="fl">0</span>, <span class="fl">350</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">emodel_factorial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/event_model.html">event_model</a></span><span class="op">(</span></span>
<span>  <span class="va">onset</span> <span class="op">~</span> <span class="fu"><a href="../reference/hrf.html">hrf</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">B</span>, contrasts <span class="op">=</span> <span class="fu"><a href="../reference/contrast_set.html">contrast_set</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/oneway_contrast.html">oneway_contrast</a></span><span class="op">(</span><span class="op">~</span> <span class="va">A</span>, name <span class="op">=</span> <span class="st">"main_A"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/oneway_contrast.html">oneway_contrast</a></span><span class="op">(</span><span class="op">~</span> <span class="va">B</span>, name <span class="op">=</span> <span class="st">"main_B"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/interaction_contrast.html">interaction_contrast</a></span><span class="op">(</span><span class="op">~</span> <span class="va">A</span> <span class="op">*</span> <span class="va">B</span>, name <span class="op">=</span> <span class="st">"A_by_B"</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    onset <span class="op">=</span> <span class="va">factorial_onsets</span>,</span>
<span>    A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">factor_A</span><span class="op">)</span>,</span>
<span>    B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">factor_B</span><span class="op">)</span>,</span>
<span>    block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n_trials</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  block <span class="op">=</span> <span class="op">~</span> <span class="va">block</span>,</span>
<span>  sampling_frame <span class="op">=</span> <span class="va">sframe</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">interaction_contrasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/contrast_weights.html">contrast_weights</a></span><span class="op">(</span><span class="va">emodel_factorial</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">interaction_contrasts</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">weights</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`A:B#main_A`</span></span>
<span><span class="co">#&gt;           main_A_1</span></span>
<span><span class="co">#&gt; A.A1_B.B1       -1</span></span>
<span><span class="co">#&gt; A.A2_B.B1        1</span></span>
<span><span class="co">#&gt; A.A1_B.B2       -1</span></span>
<span><span class="co">#&gt; A.A2_B.B2        1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`A:B#main_B`</span></span>
<span><span class="co">#&gt;           main_B_1</span></span>
<span><span class="co">#&gt; A.A1_B.B1       -1</span></span>
<span><span class="co">#&gt; A.A2_B.B1       -1</span></span>
<span><span class="co">#&gt; A.A1_B.B2        1</span></span>
<span><span class="co">#&gt; A.A2_B.B2        1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`A:B#A_by_B`</span></span>
<span><span class="co">#&gt;       A_by_B_1</span></span>
<span><span class="co">#&gt; A1_B1        1</span></span>
<span><span class="co">#&gt; A2_B1       -1</span></span>
<span><span class="co">#&gt; A1_B2       -1</span></span>
<span><span class="co">#&gt; A2_B2        1</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="parametric-modulators-do-you-need-a-contrast">Parametric Modulators: Do You Need a Contrast?<a class="anchor" aria-label="anchor" href="#parametric-modulators-do-you-need-a-contrast"></a>
</h2>
<p>For a simple parametric modulator (e.g., <code>hrf(RT)</code> with a
single‑basis HRF), the effect is captured by a single regressor. In
standard GLM software, the t‑test on that coefficient directly tests the
parametric effect—no explicit contrast is required. Contrasts are useful
if you need to combine multiple columns (e.g., multi‑basis HRF, or a set
of RT‑by‑condition regressors) into a single hypothesis.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Design with conditions and RT modulation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">567</span><span class="op">)</span></span>
<span><span class="va">n_events</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">pm_conditions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"congruent"</span>, <span class="st">"incongruent"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span>
<span><span class="va">pm_onsets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_events</span>, <span class="fl">0</span>, <span class="fl">350</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pm_RT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_events</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">pm_conditions</span> <span class="op">==</span> <span class="st">"congruent"</span>, <span class="fl">0.5</span>, <span class="fl">0.7</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">emodel_parametric</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/event_model.html">event_model</a></span><span class="op">(</span></span>
<span>  <span class="va">onset</span> <span class="op">~</span> <span class="fu"><a href="../reference/hrf.html">hrf</a></span><span class="op">(</span><span class="va">condition</span>,</span>
<span>              contrasts <span class="op">=</span> <span class="fu"><a href="../reference/pair_contrast.html">pair_contrast</a></span><span class="op">(</span><span class="op">~</span> <span class="va">condition</span> <span class="op">==</span> <span class="st">"incongruent"</span>, <span class="op">~</span> <span class="va">condition</span> <span class="op">==</span> <span class="st">"congruent"</span>, name <span class="op">=</span> <span class="st">"incongruent_gt_congruent"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>          <span class="fu"><a href="../reference/hrf.html">hrf</a></span><span class="op">(</span><span class="va">RT</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    onset <span class="op">=</span> <span class="va">pm_onsets</span>,</span>
<span>    condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">pm_conditions</span><span class="op">)</span>,</span>
<span>    RT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">pm_RT</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>    block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n_events</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  block <span class="op">=</span> <span class="op">~</span> <span class="va">block</span>,</span>
<span>  sampling_frame <span class="op">=</span> <span class="va">sframe</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Categorical contrast (condition) is attached; the RT parametric term is a single regressor.</span></span>
<span><span class="co"># Identify its column(s) for reporting; the model t‑stat on this column tests the parametric effect.</span></span>
<span><span class="va">dm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design_matrix.html">design_matrix</a></span><span class="op">(</span><span class="va">emodel_parametric</span><span class="op">)</span></span>
<span><span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/term_indices.html">term_indices</a></span><span class="op">(</span><span class="va">dm</span><span class="op">)</span></span>
<span><span class="va">idx</span><span class="op">[[</span><span class="st">"RT"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dm</span><span class="op">)</span><span class="op">[</span><span class="va">idx</span><span class="op">[[</span><span class="st">"RT"</span><span class="op">]</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] "RT_RT"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="f-contrasts-for-omnibus-tests">F-contrasts for Omnibus Tests<a class="anchor" aria-label="anchor" href="#f-contrasts-for-omnibus-tests"></a>
</h2>
<p>F-contrasts test multiple parameters simultaneously:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Four-condition design for omnibus test</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">890</span><span class="op">)</span></span>
<span><span class="va">conditions_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span><span class="va">onsets_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">48</span>, <span class="fl">0</span>, <span class="fl">350</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Using oneway_contrast for main effect</span></span>
<span><span class="va">emodel_omnibus</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/event_model.html">event_model</a></span><span class="op">(</span></span>
<span>  <span class="va">onset</span> <span class="op">~</span> <span class="fu"><a href="../reference/hrf.html">hrf</a></span><span class="op">(</span><span class="va">condition</span>, </span>
<span>              contrasts <span class="op">=</span> <span class="fu"><a href="../reference/oneway_contrast.html">oneway_contrast</a></span><span class="op">(</span><span class="op">~</span> <span class="va">condition</span>, name <span class="op">=</span> <span class="st">"main_effect"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    onset <span class="op">=</span> <span class="va">onsets_4</span>,</span>
<span>    condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">conditions_4</span><span class="op">)</span>,</span>
<span>    block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">48</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  block <span class="op">=</span> <span class="op">~</span> <span class="va">block</span>,</span>
<span>  sampling_frame <span class="op">=</span> <span class="va">sframe</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract F-contrast</span></span>
<span><span class="va">f_contrasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Fcontrasts.html">Fcontrasts</a></span><span class="op">(</span><span class="va">emodel_omnibus</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">f_contrasts</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`condition#condition`</span></span>
<span><span class="co">#&gt;                       c1 c2 c3</span></span>
<span><span class="co">#&gt; condition_condition.A  1  0  0</span></span>
<span><span class="co">#&gt; condition_condition.B  0  1  0</span></span>
<span><span class="co">#&gt; condition_condition.C  0  0  1</span></span>
<span><span class="co">#&gt; condition_condition.D -1 -1 -1</span></span>
<span><span class="co">#&gt; attr(,"term_indices")</span></span>
<span><span class="co">#&gt; [1] 1 2 3 4</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="working-with-contrast-weights">Working with Contrast Weights<a class="anchor" aria-label="anchor" href="#working-with-contrast-weights"></a>
</h2>
<div class="section level3">
<h3 id="extracting-and-manipulating-weights">Extracting and Manipulating Weights<a class="anchor" aria-label="anchor" href="#extracting-and-manipulating-weights"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a model</span></span>
<span><span class="va">simple_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/event_model.html">event_model</a></span><span class="op">(</span></span>
<span>  <span class="va">onset</span> <span class="op">~</span> <span class="fu"><a href="../reference/hrf.html">hrf</a></span><span class="op">(</span><span class="va">stim</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    onset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">70</span>, <span class="fl">90</span><span class="op">)</span>,</span>
<span>    stim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"A"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  block <span class="op">=</span> <span class="op">~</span> <span class="va">block</span>,</span>
<span>  sampling_frame <span class="op">=</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame</a></span><span class="op">(</span><span class="fl">60</span>, TR <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Manually create contrast weights</span></span>
<span><span class="va">design_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design_matrix.html">design_matrix</a></span><span class="op">(</span><span class="va">simple_model</span><span class="op">)</span></span>
<span><span class="va">n_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">design_mat</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a custom contrast vector</span></span>
<span><span class="va">custom_contrast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_cols</span><span class="op">)</span></span>
<span><span class="co"># Find columns for condition A and B</span></span>
<span><span class="co"># Note: column names use dot notation for factor levels (e.g., "stim.A")</span></span>
<span><span class="va">col_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">design_mat</span><span class="op">)</span></span>
<span><span class="co"># Match by suffix to handle term-tag prefixes like "stim_stim.A"</span></span>
<span><span class="va">a_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"stim\\.A$"</span>, <span class="va">col_names</span><span class="op">)</span></span>
<span><span class="va">b_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"stim\\.B$"</span>, <span class="va">col_names</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># A &gt; B contrast</span></span>
<span><span class="va">custom_contrast</span><span class="op">[</span><span class="va">a_cols</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">a_cols</span><span class="op">)</span></span>
<span><span class="va">custom_contrast</span><span class="op">[</span><span class="va">b_cols</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">b_cols</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">custom_contrast</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  1 -1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="contrast-validation">Contrast Validation<a class="anchor" aria-label="anchor" href="#contrast-validation"></a>
</h3>
<p>Validate contrasts once the model (and design matrix) is constructed.
You can validate built-in contrast specs or your own custom vectors
using <code><a href="../reference/validate_contrasts.html">validate_contrasts()</a></code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Validate the custom contrast against the design implied by the model</span></span>
<span><span class="fu"><a href="../reference/validate_contrasts.html">validate_contrasts</a></span><span class="op">(</span><span class="va">simple_model</span>, weights <span class="op">=</span> <span class="va">custom_contrast</span><span class="op">)</span></span>
<span><span class="co">#&gt;       name type estimable sum_to_zero orthogonal_to_intercept full_rank</span></span>
<span><span class="co">#&gt; 1 contrast    t      TRUE        TRUE                    TRUE        NA</span></span>
<span><span class="co">#&gt;   nonzero_weights</span></span>
<span><span class="co">#&gt; 1               2</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="contrasts-for-multi-run-designs">Contrasts for Multi-Run Designs<a class="anchor" aria-label="anchor" href="#contrasts-for-multi-run-designs"></a>
</h2>
<p>When working with multiple runs, contrasts can be specified to test
within-run or across-run effects:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Two-run experiment with potential run differences</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">345</span><span class="op">)</span></span>
<span><span class="va">run1_onsets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">0</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">run2_onsets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">0</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">all_onsets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">run1_onsets</span>, <span class="va">run2_onsets</span><span class="op">)</span></span>
<span><span class="va">all_conditions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stim"</span>, <span class="st">"control"</span><span class="op">)</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">all_blocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, each <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="va">emodel_multirun</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/event_model.html">event_model</a></span><span class="op">(</span></span>
<span>  <span class="va">onset</span> <span class="op">~</span> <span class="fu"><a href="../reference/hrf.html">hrf</a></span><span class="op">(</span><span class="va">condition</span>, <span class="va">block</span>,</span>
<span>              contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                overall   <span class="op">=</span> <span class="fu"><a href="../reference/pair_contrast.html">pair_contrast</a></span><span class="op">(</span><span class="op">~</span> <span class="va">condition</span> <span class="op">==</span> <span class="st">"stim"</span>, <span class="op">~</span> <span class="va">condition</span> <span class="op">==</span> <span class="st">"control"</span>, name <span class="op">=</span> <span class="st">"overall"</span><span class="op">)</span>,</span>
<span>                run1_only <span class="op">=</span> <span class="fu"><a href="../reference/pair_contrast.html">pair_contrast</a></span><span class="op">(</span><span class="op">~</span> <span class="va">condition</span> <span class="op">==</span> <span class="st">"stim"</span>, <span class="op">~</span> <span class="va">condition</span> <span class="op">==</span> <span class="st">"control"</span>, name <span class="op">=</span> <span class="st">"run1"</span>, where <span class="op">=</span> <span class="op">~</span> <span class="va">block</span> <span class="op">==</span> <span class="st">"1"</span><span class="op">)</span>,</span>
<span>                run2_only <span class="op">=</span> <span class="fu"><a href="../reference/pair_contrast.html">pair_contrast</a></span><span class="op">(</span><span class="op">~</span> <span class="va">condition</span> <span class="op">==</span> <span class="st">"stim"</span>, <span class="op">~</span> <span class="va">condition</span> <span class="op">==</span> <span class="st">"control"</span>, name <span class="op">=</span> <span class="st">"run2"</span>, where <span class="op">=</span> <span class="op">~</span> <span class="va">block</span> <span class="op">==</span> <span class="st">"2"</span><span class="op">)</span></span>
<span>              <span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    onset <span class="op">=</span> <span class="va">all_onsets</span>,</span>
<span>    condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">all_conditions</span><span class="op">)</span>,</span>
<span>    block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">all_blocks</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  block <span class="op">=</span> <span class="op">~</span> <span class="va">block</span>,</span>
<span>  sampling_frame <span class="op">=</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">120</span>, <span class="fl">120</span><span class="op">)</span>, TR <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">multirun_contrasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/contrast_weights.html">contrast_weights</a></span><span class="op">(</span><span class="va">emodel_multirun</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">multirun_contrasts</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "condition:block#overall" "condition:block#run1"   </span></span>
<span><span class="co">#&gt; [3] "condition:block#run2"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="contrast-specification-best-practices">Contrast Specification Best Practices<a class="anchor" aria-label="anchor" href="#contrast-specification-best-practices"></a>
</h2>
<p>Plan contrasts a priori, keep them simple and interpretable, and
prefer orthogonal sets when possible.</p>
<div class="section level3">
<h3 id="scaling-and-normalization">2. Scaling and Normalization<a class="anchor" aria-label="anchor" href="#scaling-and-normalization"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Properly scaled contrasts sum to zero</span></span>
<span><span class="va">create_scaled_contrast</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_positive</span>, <span class="va">n_negative</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">n_positive</span>, <span class="va">n_positive</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="va">n_negative</span>, <span class="va">n_negative</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Example: 3 vs 2 conditions</span></span>
<span><span class="va">scaled_contrast</span> <span class="op">&lt;-</span> <span class="fu">create_scaled_contrast</span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">scaled_contrast</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  0.3333333  0.3333333  0.3333333 -0.5000000 -0.5000000</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">scaled_contrast</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Should be ~0</span></span>
<span><span class="co">#&gt; [1] -5.551115e-17</span></span></code></pre></div>
<!-- Section on multiple-comparison correction removed: not standard within-model in typical fMRI GLM workflows. Downstream group analysis packages handle control of false positives across space/contrasts. -->
<!-- Section on downstream statistical fitting removed to keep the vignette focused on
     building and validating contrasts. GLM fitting and inference vary by toolbox and
     are typically handled outside fmridesign. -->
</div>
</div>
<div class="section level2">
<h2 id="advanced-topics">Advanced Topics<a class="anchor" aria-label="anchor" href="#advanced-topics"></a>
</h2>
<div class="section level3">
<h3 id="custom-contrast-functions">Custom Contrast Functions<a class="anchor" aria-label="anchor" href="#custom-contrast-functions"></a>
</h3>
<p>You can generate complex patterns via helper generators that return
contrast specifications. For example, a sliding-window set that compares
adjacent, disjoint windows across an ordered factor:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Five ordered levels</span></span>
<span><span class="va">lvl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"L"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build a small model with an ordered factor</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">111</span><span class="op">)</span></span>
<span><span class="va">emod_sliding</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/event_model.html">event_model</a></span><span class="op">(</span></span>
<span>  <span class="va">onset</span> <span class="op">~</span> <span class="fu"><a href="../reference/hrf.html">hrf</a></span><span class="op">(</span><span class="va">level</span>, contrasts <span class="op">=</span> <span class="fu"><a href="../reference/sliding_window_contrasts.html">sliding_window_contrasts</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="va">lvl</span>, facname <span class="op">=</span> <span class="st">"level"</span>, window_size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    onset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">0</span>, <span class="fl">350</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">lvl</span>, <span class="fl">50</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, levels <span class="op">=</span> <span class="va">lvl</span>, ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  block <span class="op">=</span> <span class="op">~</span> <span class="va">block</span>,</span>
<span>  sampling_frame <span class="op">=</span> <span class="va">sframe</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Inspect the generated contrasts</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="../reference/contrast_weights.html">contrast_weights</a></span><span class="op">(</span><span class="va">emod_sliding</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "level#win_L1_vs_L2" "level#win_L2_vs_L3" "level#win_L3_vs_L4"</span></span>
<span><span class="co">#&gt; [4] "level#win_L4_vs_L5"</span></span></code></pre></div>
<p>For more targeted patterns (e.g., specific basis functions or
continuous terms), use <code><a href="../reference/column_contrast.html">column_contrast()</a></code> with regex to
match design-matrix columns.</p>
</div>
</div>
<div class="section level2">
<h2 id="troubleshooting-common-issues">Troubleshooting Common Issues<a class="anchor" aria-label="anchor" href="#troubleshooting-common-issues"></a>
</h2>
<div class="section level3">
<h3 id="rank-deficient-contrasts">1. Rank-Deficient Contrasts<a class="anchor" aria-label="anchor" href="#rank-deficient-contrasts"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This will cause issues - contrast is not estimable</span></span>
<span><span class="va">bad_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  onset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>  condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"A"</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># Only one level!</span></span>
<span>  block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This will warn about the issue</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">bad_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/event_model.html">event_model</a></span><span class="op">(</span></span>
<span>    <span class="va">onset</span> <span class="op">~</span> <span class="fu"><a href="../reference/hrf.html">hrf</a></span><span class="op">(</span><span class="va">condition</span>, contrasts <span class="op">=</span> <span class="fu"><a href="../reference/pair_contrast.html">pair_contrast</a></span><span class="op">(</span><span class="op">~</span> <span class="va">condition</span> <span class="op">==</span> <span class="st">"A"</span>, <span class="op">~</span> <span class="va">condition</span> <span class="op">==</span> <span class="st">"B"</span>, name <span class="op">=</span> <span class="st">"A_vs_B"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">bad_data</span>,</span>
<span>    block <span class="op">=</span> <span class="op">~</span> <span class="va">block</span>,</span>
<span>    sampling_frame <span class="op">=</span> <span class="fu"><a href="https://bbuchsbaum.github.io/fmrihrf/reference/sampling_frame.html" class="external-link">sampling_frame</a></span><span class="op">(</span><span class="fl">50</span>, TR <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Error: Cannot create contrast for single-level factor"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="multicollinearity-in-contrasts">2. Multicollinearity in Contrasts<a class="anchor" aria-label="anchor" href="#multicollinearity-in-contrasts"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check for multicollinearity in your design matrix</span></span>
<span><span class="va">cc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_collinearity.html">check_collinearity</a></span><span class="op">(</span><span class="fu"><a href="../reference/design_matrix.html">design_matrix</a></span><span class="op">(</span><span class="va">emodel_with_contrast</span><span class="op">)</span>, threshold <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">cc</span><span class="op">$</span><span class="va">ok</span><span class="op">)</span> <span class="va">cc</span><span class="op">$</span><span class="va">pairs</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>Define contrasts inline, extract weights cleanly, and validate before
analysis. Use t-contrasts for directional tests and F-contrasts for
omnibus effects. - Complex designs: handle factorial, parametric, and
multi‑run contrasts - Validation tools: ensure contrasts are properly
specified and estimable</p>
<p>Remember to: - Plan contrasts based on your hypotheses - Validate
contrast properties before analysis - Document your contrast
specifications for reproducibility</p>
<p>For more information on event and baseline models, see: -
<code><a href="../articles/a_01_introduction.html">vignette("a_01_introduction")</a></code> -
<code><a href="../articles/a_03_baseline_model.html">vignette("a_03_baseline_model")</a></code> -
<code><a href="../articles/a_04_event_models.html">vignette("a_04_event_models")</a></code></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bradley Buchsbaum.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
