---
phase: 02-namespace-metadata
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - R/naming-utils.R
  - R/design_generics.R
  - R/condition_basis_list.R
  - R/hrf-formula.R
  - R/event_vector.R
  - DESCRIPTION
  - NAMESPACE
autonomous: true

must_haves:
  truths:
    - "NAMESPACE contains only user-facing functions (internal helpers unexported)"
    - "All internal helpers have @keywords internal in roxygen comments"
    - "DESCRIPTION Authors@R includes 'cph' (copyright holder) role"
    - "All S3 methods remain properly exported"
  artifacts:
    - path: "NAMESPACE"
      provides: "Clean namespace with only public API"
      contains: "export(event_model)"
    - path: "DESCRIPTION"
      provides: "CRAN-compliant metadata"
      contains: "cph"
    - path: "R/naming-utils.R"
      provides: "Internal naming utilities marked correctly"
      contains: "@keywords internal"
  key_links:
    - from: "R/*.R"
      to: "NAMESPACE"
      via: "roxygen2 @export tags"
      pattern: "@export"
---

<objective>
Audit and fix namespace exports and DESCRIPTION metadata for CRAN compliance.

Purpose: Ensure only user-facing functions are exported, internal utilities are properly marked, and DESCRIPTION metadata is complete per CRAN requirements.

Output: Clean NAMESPACE with minimal public API, DESCRIPTION with 'cph' role in Authors@R.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-namespace-metadata/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Unexport internal utility functions</name>
  <files>R/naming-utils.R, R/design_generics.R, R/condition_basis_list.R, R/hrf-formula.R, R/event_vector.R</files>
  <action>
Remove @export tags from internal utility functions that should not be part of the public API. Based on research, these functions should be unexported:

1. **R/naming-utils.R:**
   - `sanitize()` - Remove @export, add @keywords internal (naming utility, users don't call directly)
   - `basis_suffix()` - Remove @export, add @keywords internal (internal naming helper)
   - `feature_suffix()` - Remove @export, add @keywords internal (internal naming helper)

2. **R/design_generics.R:**
   - `split_by_block()` - Remove @export, add @keywords internal (internal utility with no public methods)
   - `column_groups_by_condition()` - If exists as exported, remove @export (research identified as internal)

3. **R/hrf-formula.R:**
   - `boxcar_hrf_gen()` - Review if documented as user API; if not in vignettes, remove @export
   - `weighted_hrf_gen()` - Review if documented as user API; if not in vignettes, remove @export

4. **R/condition_basis_list.R:**
   - Review `condition_basis_list()` - This is borderline; if not documented in vignettes as user API, remove @export

For each function modified:
- Remove the `#' @export` line
- Add `#' @keywords internal` (if not already present)
- Keep `#' @noRd` only if the function should have NO documentation at all
- If function has good documentation, keep docs but just mark internal

**Important:** Do NOT unexport these (they are part of extension API or user-facing):
- All functions in R/extension_registry.R (register_hrfspec_extension, etc.)
- Core generics (event_model, design_matrix, hrf, etc.)
- All S3 methods (roxygen2 handles these correctly)

After modifications, run: `devtools::document()` to regenerate NAMESPACE.
  </action>
  <verify>
Run: `R -e "devtools::document(); cat(readLines('NAMESPACE'), sep='\n')" | grep -E "^export\(sanitize|^export\(basis_suffix|^export\(feature_suffix|^export\(split_by_block"`

Should return NO matches (these functions should no longer be exported).

Also verify S3 methods still present: `grep "S3method" NAMESPACE | wc -l` should show ~136 methods.
  </verify>
  <done>
Internal utility functions (sanitize, basis_suffix, feature_suffix, split_by_block) are no longer in NAMESPACE exports. S3 methods remain exported. Export count reduced from 93 to approximately 85-88.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add 'cph' role to Authors@R</name>
  <files>DESCRIPTION</files>
  <action>
Update the Authors@R field in DESCRIPTION to include the 'cph' (copyright holder) role.

**Current:**
```
Authors@R: person("Bradley", "Buchsbaum", role = c("aut", "cre"), email = "brad.buchsbaum@gmail.com")
```

**Change to:**
```
Authors@R: person("Bradley", "Buchsbaum", role = c("aut", "cre", "cph"), email = "brad.buchsbaum@gmail.com")
```

This is strongly recommended by CRAN for individual package authors who hold copyright.
  </action>
  <verify>
Run: `grep -A1 "Authors@R" DESCRIPTION`

Should show: `role = c("aut", "cre", "cph")`
  </verify>
  <done>
DESCRIPTION Authors@R field includes 'cph' role alongside 'aut' and 'cre'.
  </done>
</task>

<task type="auto">
  <name>Task 3: Regenerate NAMESPACE and verify compliance</name>
  <files>NAMESPACE</files>
  <action>
After Task 1 modifications, regenerate NAMESPACE and run verification checks:

1. Run `devtools::document()` to regenerate NAMESPACE from roxygen comments

2. Run `devtools::check()` to verify:
   - No "Undocumented S3 methods" NOTEs
   - No "Undocumented objects" NOTEs
   - No "Objects exported but not documented" warnings
   - S3 methods still properly detected and exported

3. Count exports to confirm reduction:
   - Original: 93 export() declarations
   - Target: ~85-88 export() declarations (after removing 5-8 internal utilities)

4. Verify no ::: calls introduced (should already pass from research):
   `grep -r ":::" R/*.R` should return empty or only show external package access patterns (not internal function access)

If any devtools::check() issues arise related to namespace changes, fix them before proceeding.
  </action>
  <verify>
Run: `R -e "devtools::check(args = c('--no-tests', '--no-vignettes', '--no-manual'))" 2>&1 | grep -E "(ERROR|WARNING|checking S3|NAMESPACE)"`

Should show:
- No ERRORs
- No WARNINGs related to NAMESPACE or S3 methods
- "checking S3 generic/method consistency ... OK"

Also: `grep "^export(" NAMESPACE | wc -l` should show approximately 85-88 (reduced from 93).
  </verify>
  <done>
NAMESPACE regenerated with reduced exports. devtools::check() passes with no NAMESPACE-related errors or warnings. S3 methods properly exported. Export count reduced.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Namespace audit:**
   - `grep "^export(" NAMESPACE | wc -l` shows 85-90 exports (reduced from 93)
   - `grep "^S3method(" NAMESPACE | wc -l` shows ~136 methods (unchanged)
   - Internal utilities (sanitize, basis_suffix, feature_suffix, split_by_block) NOT in exports

2. **DESCRIPTION check:**
   - `grep "cph" DESCRIPTION` returns a match in Authors@R line

3. **Package check:**
   - `devtools::check(args = c('--as-cran', '--no-tests'))` passes with 0 errors, 0 warnings related to namespace/DESCRIPTION

4. **No breaking changes:**
   - Extension API functions still exported (register_hrfspec_extension, etc.)
   - All S3 methods still work
</verification>

<success_criteria>
1. NAMESPACE export count reduced from 93 to ~85-90 (internal utilities unexported)
2. All unexported functions have @keywords internal in their roxygen comments
3. DESCRIPTION Authors@R includes 'cph' role
4. devtools::check() shows 0 errors, 0 warnings for namespace/DESCRIPTION issues
5. All 136 S3 methods remain properly exported
6. No ::: calls to unexported functions in package code
</success_criteria>

<output>
After completion, create `.planning/phases/02-namespace-metadata/02-01-SUMMARY.md`
</output>
